#!/bin/sh

set -e

. /usr/share/debconf/confmodule

if [ -s /etc/default/nodm ] ; then
	. /etc/default/nodm

	if [ -n "$NODM_ENABLED" ] ; then
		db_set nodm/enabled "$NODM_ENABLED"
	fi
	if [ -n "$NODM_USER" ] ; then
		db_set nodm/user "$NODM_USER"
	fi
	if [ -n "$NODM_FIRST_VT" ] ; then
		db_set nodm/first_vt "$NODM_FIRST_VT"
	fi
	if [ -n "$NODM_X_OPTIONS" ] ; then
		db_set nodm/x_options "$NODM_X_OPTIONS"
	fi
	if [ -n "$NODM_MIN_SESSION_TIME" ]; then
		db_set nodm/min_session_time "$NODM_MIN_SESSION_TIME"
	fi
	if [ -n "$NODM_XINIT" ]; then
		db_set nodm/xinit "$NODM_XINIT"
	fi
	if [ -n "$NODM_XSESSION" ]; then
		db_set nodm/xsession "$NODM_XSESSION"
	fi
fi

db_input medium nodm/enabled || true
db_go

db_get nodm/enabled
START="$RET"

if [ "x$START" = "xtrue" ] ; then
	db_input medium nodm/user || true
	db_go

	db_input low nodm/first_vt || true
        db_go

        db_input low nodm/x_options || true
        db_go

	db_input low nodm/min_session_time || true
	db_go

	db_input low nodm/xinit || true
	db_go

	db_input low nodm/xsession || true
	db_go
fi

